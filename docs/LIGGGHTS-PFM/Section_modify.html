

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>12. Modifying &amp; extending LAMMPS &mdash; LIGGGHTS Academic 24.01
 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="LIGGGHTS Academic 24.01
 documentation" href="index.html"/>
        <link rel="next" title="13. Python interface to LAMMPS" href="Section_python.html"/>
        <link rel="prev" title="11. Additional tools" href="Section_tools.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="Manual.html" class="icon icon-home"> LIGGGHTS Academic
        

        
        </a>

        
          
          
            <div class="version">
              24.01

            </div>
          
        

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Section_intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_start.html">2. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_commands.html">3. Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_gran_models.html">4. Contact models</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_packages.html">5. Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_accelerate.html">6. Accelerating LAMMPS performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_howto.html">7. How-to discussions</a></li>
<li class="toctree-l1"><a class="reference internal" href="superquadric_simulations.html">8. How-to for superquadric particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_example.html">9. Example problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_perf.html">10. Performance &amp; scalability</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_tools.html">11. Additional tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">12. Modifying &amp; extending LAMMPS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#atom-styles">12.1. Atom styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bond-angle-dihedral-improper-potentials">12.2. Bond, angle, dihedral, improper potentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compute-styles">12.3. Compute styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dump-styles">12.4. Dump styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dump-custom-output-options">12.5. Dump custom output options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fix-styles">12.6. Fix styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mod-7">12.7. Input script commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="#kspace-computations">12.8. Kspace computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#minimization-styles">12.9. Minimization styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pairwise-potentials">12.10. Pairwise potentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="#region-styles">12.11. Region styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#body-styles">12.12. Body styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#thermodynamic-output-options">12.13. Thermodynamic output options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variable-options">12.14. Variable options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#submitting-new-features-for-inclusion-in-lammps">12.15. Submitting new features for inclusion in LAMMPS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Section_python.html">13. Python interface to LAMMPS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_errors.html">14. Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Section_history.html">15. Future and history</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Index</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="computes.html">Computes</a></li>
<li class="toctree-l1"><a class="reference internal" href="fixes.html">Fixes</a></li>
<li class="toctree-l1"><a class="reference internal" href="pairs.html">Pair Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="granular.html">Granular Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="bonds.html">Bond Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="angles.html">Angle Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="dihedrals.html">Dihedral Styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="impropers.html">Improper Styles</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="Manual.html">LIGGGHTS Academic</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="Manual.html">Docs</a> &raquo;</li>
      
    <li><span class="section-number">12. </span>Modifying &amp; extending LAMMPS</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="http://lammps.sandia.gov">Website</a>
            <a href="Section_commands.html#comm">Commands</a>
        
      </li>
  </ul>
  <hr/>
  
    <div class="rst-footer-buttons" style="margin-bottom: 1em" role="navigation" aria-label="footer navigation">
      
        <a href="Section_python.html" class="btn btn-neutral float-right" title="13. Python interface to LAMMPS" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Section_tools.html" class="btn btn-neutral" title="11. Additional tools" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="modifying-extending-lammps">
<h1><span class="section-number">12. </span>Modifying &amp; extending LAMMPS<a class="headerlink" href="#modifying-extending-lammps" title="Permalink to this heading">¶</a></h1>
<p>This section describes how to customize LAMMPS by modifying
and extending its source code.</p>
<div class="line-block">
<div class="line">11.1 <a class="reference internal" href="#mod-1"><span class="std std-ref">Atom styles</span></a></div>
<div class="line">11.2 <a class="reference internal" href="#mod-2"><span class="std std-ref">Bond, angle, dihedral, improper potentials</span></a></div>
<div class="line">11.3 <a class="reference internal" href="#mod-3"><span class="std std-ref">Compute styles</span></a></div>
<div class="line">11.4 <a class="reference internal" href="#mod-4"><span class="std std-ref">Dump styles</span></a></div>
<div class="line">11.5 <a class="reference internal" href="#mod-5"><span class="std std-ref">Dump custom output options</span></a></div>
<div class="line">11.6 <a class="reference internal" href="#mod-6"><span class="std std-ref">Fix styles</span></a> which include integrators,      temperature and pressure control, force constraints,      boundary conditions, diagnostic output, etc</div>
<div class="line">11.7 <a class="reference external" href="mod_7">Input script commands</a></div>
<div class="line">11.8 <a class="reference internal" href="#mod-8"><span class="std std-ref">Kspace computations</span></a></div>
<div class="line">11.9 <a class="reference internal" href="#mod-9"><span class="std std-ref">Minimization styles</span></a></div>
<div class="line">11.10 <a class="reference internal" href="#mod-10"><span class="std std-ref">Pairwise potentials</span></a></div>
<div class="line">11.11 <a class="reference internal" href="#mod-11"><span class="std std-ref">Region styles</span></a></div>
<div class="line">11.12 <a class="reference internal" href="#mod-12"><span class="std std-ref">Body styles</span></a></div>
<div class="line">11.13 <a class="reference internal" href="#mod-13"><span class="std std-ref">Thermodynamic output options</span></a></div>
<div class="line">11.14 <a class="reference internal" href="#mod-14"><span class="std std-ref">Variable options</span></a></div>
<div class="line">11.15 <a class="reference internal" href="#mod-15"><span class="std std-ref">Submitting new features for inclusion in LAMMPS</span></a></div>
<div class="line"><br /></div>
</div>
<p>LAMMPS is designed in a modular fashion so as to be easy to modify and
extend with new functionality.  In fact, about 75% of its source code
is files added in this fashion.</p>
<p>In this section, changes and additions users can make are listed along
with minimal instructions.  If you add a new feature to LAMMPS and
think it will be of interest to general users, we encourage you to
submit it to the developers for inclusion in the released version of
LAMMPS.  Information about how to do this is provided
<a class="reference internal" href="#mod-14"><span class="std std-ref">below</span></a>.</p>
<p>The best way to add a new feature is to find a similar feature in
LAMMPS and look at the corresponding source and header files to figure
out what it does.  You will need some knowledge of C++ to be able to
understand the hi-level structure of LAMMPS and its class
organization, but functions (class methods) that do actual
computations are written in vanilla C-style code and operate on simple
C-style data structures (vectors and arrays).</p>
<p>Most of the new features described in this section require you to
write a new C++ derived class (except for exceptions described below,
where you can make small edits to existing files).  Creating a new
class requires 2 files, a source code file (*.cpp) and a header file
(*.h).  The derived class must provide certain methods to work as a
new option.  Depending on how different your new feature is compared
to existing features, you can either derive from the base class
itself, or from a derived class that already exists.  Enabling LAMMPS
to invoke the new class is as simple as putting the two source
files in the src dir and re-building LAMMPS.</p>
<p>The advantage of C++ and its object-orientation is that all the code
and variables needed to define the new feature are in the 2 files you
write, and thus shouldn’t make the rest of LAMMPS more complex or
cause side-effect bugs.</p>
<p>Here is a concrete example.  Suppose you write 2 files pair_foo.cpp
and pair_foo.h that define a new class PairFoo that computes pairwise
potentials described in the classic 1997 <a class="reference internal" href="#foo"><span class="std std-ref">paper</span></a> by Foo, et al.
If you wish to invoke those potentials in a LAMMPS input script with a
command like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pair_style</span> <span class="n">foo</span> <span class="mf">0.1</span> <span class="mf">3.5</span>
</pre></div>
</div>
<p>then your pair_foo.h file should be structured as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ifdef PAIR_CLASS</span>
<span class="n">PairStyle</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span><span class="n">PairFoo</span><span class="p">)</span>
<span class="c1">#else</span>
<span class="o">...</span>
<span class="p">(</span><span class="k">class</span><span class="w"> </span><span class="nc">definition</span> <span class="k">for</span> <span class="n">PairFoo</span><span class="p">)</span>
<span class="o">...</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<p>where “foo” is the style keyword in the pair_style command, and
PairFoo is the class name defined in your pair_foo.cpp and pair_foo.h
files.</p>
<p>When you re-build LAMMPS, your new pairwise potential becomes part of
the executable and can be invoked with a pair_style command like the
example above.  Arguments like 0.1 and 3.5 can be defined and
processed by your new class.</p>
<p>As illustrated by this pairwise example, many kinds of options are
referred to in the LAMMPS documentation as the “style” of a particular
command.</p>
<p>The instructions below give the header file for the base class that
these styles are derived from.  Public variables in that file are ones
used and set by the derived classes which are also used by the base
class.  Sometimes they are also used by the rest of LAMMPS.  Virtual
functions in the base class header file which are set = 0 are ones you
must define in your new derived class to give it the functionality
LAMMPS expects.  Virtual functions that are not set to 0 are functions
you can optionally define.</p>
<p>Additionally, new output options can be added directly to the
thermo.cpp, dump_custom.cpp, and variable.cpp files as explained
below.</p>
<p>Here are additional guidelines for modifying LAMMPS and adding new
functionality:</p>
<ul class="simple">
<li><p>Think about whether what you want to do would be better as a pre- or
post-processing step.  Many computations are more easily and more
quickly done that way.</p></li>
<li><p>Don’t do anything within the timestepping of a run that isn’t
parallel.  E.g. don’t accumulate a bunch of data on a single processor
and analyze it.  You run the risk of seriously degrading the parallel
efficiency.</p></li>
<li><p>If your new feature reads arguments or writes output, make sure you
follow the unit conventions discussed by the <a class="reference internal" href="units.html"><span class="doc">units</span></a>
command.</p></li>
<li><p>If you add something you think is truly useful and doesn’t impact
LAMMPS performance when it isn’t used, send an email to the
<a class="reference external" href="http://lammps.sandia.gov/authors.html">developers</a>.  We might be
interested in adding it to the LAMMPS distribution.  See further
details on this at the bottom of this page.</p></li>
</ul>
<section id="atom-styles">
<span id="mod-1"></span><h2><span class="section-number">12.1. </span>Atom styles<a class="headerlink" href="#atom-styles" title="Permalink to this heading">¶</a></h2>
<p>Classes that define an <a class="reference internal" href="atom_style.html"><span class="doc">atom style</span></a> are derived from
the AtomVec class and managed by the Atom class.  The atom style
determines what attributes are associated with an atom.  A new atom
style can be created if one of the existing atom styles does not
define all the attributes you need to store and communicate with
atoms.</p>
<p>Atom_vec_atomic.cpp is a simple example of an atom style.</p>
<p>Here is a brief description of methods you define in your new derived
class.  See atom_vec.h for details.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 76%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>init</p></td>
<td><p>one time setup (optional)</p></td>
</tr>
<tr class="row-even"><td><p>grow</p></td>
<td><p>re-allocate atom arrays to longer lengths (required)</p></td>
</tr>
<tr class="row-odd"><td><p>grow_reset</p></td>
<td><p>make array pointers in Atom and AtomVec classes consistent (required)</p></td>
</tr>
<tr class="row-even"><td><p>copy</p></td>
<td><p>copy info for one atom to another atom’s array locations (required)</p></td>
</tr>
<tr class="row-odd"><td><p>pack_comm</p></td>
<td><p>store an atom’s info in a buffer communicated every timestep (required)</p></td>
</tr>
<tr class="row-even"><td><p>pack_comm_vel</p></td>
<td><p>add velocity info to communication buffer (required)</p></td>
</tr>
<tr class="row-odd"><td><p>pack_comm_hybrid</p></td>
<td><p>store extra info unique to this atom style (optional)</p></td>
</tr>
<tr class="row-even"><td><p>unpack_comm</p></td>
<td><p>retrieve an atom’s info from the buffer (required)</p></td>
</tr>
<tr class="row-odd"><td><p>unpack_comm_vel</p></td>
<td><p>also retrieve velocity info (required)</p></td>
</tr>
<tr class="row-even"><td><p>unpack_comm_hybrid</p></td>
<td><p>retrieve extra info unique to this atom style (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>pack_reverse</p></td>
<td><p>store an atom’s info in a buffer communicating partial forces  (required)</p></td>
</tr>
<tr class="row-even"><td><p>pack_reverse_hybrid</p></td>
<td><p>store extra info unique to this atom style (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>unpack_reverse</p></td>
<td><p>retrieve an atom’s info from the buffer (required)</p></td>
</tr>
<tr class="row-even"><td><p>unpack_reverse_hybrid</p></td>
<td><p>retrieve extra info unique to this atom style (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>pack_border</p></td>
<td><p>store an atom’s info in a buffer communicated on neighbor re-builds (required)</p></td>
</tr>
<tr class="row-even"><td><p>pack_border_vel</p></td>
<td><p>add velocity info to buffer (required)</p></td>
</tr>
<tr class="row-odd"><td><p>pack_border_hybrid</p></td>
<td><p>store extra info unique to this atom style (optional)</p></td>
</tr>
<tr class="row-even"><td><p>unpack_border</p></td>
<td><p>retrieve an atom’s info from the buffer (required)</p></td>
</tr>
<tr class="row-odd"><td><p>unpack_border_vel</p></td>
<td><p>also retrieve velocity info (required)</p></td>
</tr>
<tr class="row-even"><td><p>unpack_border_hybrid</p></td>
<td><p>retrieve extra info unique to this atom style (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>pack_exchange</p></td>
<td><p>store all an atom’s info to migrate to another processor (required)</p></td>
</tr>
<tr class="row-even"><td><p>unpack_exchange</p></td>
<td><p>retrieve an atom’s info from the buffer (required)</p></td>
</tr>
<tr class="row-odd"><td><p>size_restart</p></td>
<td><p>number of restart quantities associated with proc’s atoms (required)</p></td>
</tr>
<tr class="row-even"><td><p>pack_restart</p></td>
<td><p>pack atom quantities into a buffer (required)</p></td>
</tr>
<tr class="row-odd"><td><p>unpack_restart</p></td>
<td><p>unpack atom quantities from a buffer (required)</p></td>
</tr>
<tr class="row-even"><td><p>create_atom</p></td>
<td><p>create an individual atom of this style (required)</p></td>
</tr>
<tr class="row-odd"><td><p>data_atom</p></td>
<td><p>parse an atom line from the data file (required)</p></td>
</tr>
<tr class="row-even"><td><p>data_atom_hybrid</p></td>
<td><p>parse additional atom info unique to this atom style (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>data_vel</p></td>
<td><p>parse one line of velocity information from data file (optional)</p></td>
</tr>
<tr class="row-even"><td><p>data_vel_hybrid</p></td>
<td><p>parse additional velocity data unique to this atom style (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>memory_usage</p></td>
<td><p>tally memory allocated by atom arrays (required)</p></td>
</tr>
</tbody>
</table>
<p>The constructor of the derived class sets values for several variables
that you must set when defining a new atom style, which are documented
in atom_vec.h.  New atom arrays are defined in atom.cpp.  Search for
the word “customize” and you will find locations you will need to
modify.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is possible to add some attributes, such as a
molecule ID, to atom styles that do not have them via the <a class="reference internal" href="fix_property.html"><span class="doc">fix property/atom</span></a> command.  This command also
allows new custom attributes consisting of extra integer or
floating-point values to be added to atoms.  See the <a class="reference internal" href="fix_property.html"><span class="doc">fix property/atom</span></a> doc page for examples of cases
where this is useful and details on how to initialize, access, and
output the custom values.</p>
</div>
<p>New <a class="reference internal" href="pair_style.html"><span class="doc">pair styles</span></a>, <a class="reference internal" href="fix.html"><span class="doc">fixes</span></a>, or
<a class="reference internal" href="compute.html"><span class="doc">computes</span></a> can be added to LAMMPS, as discussed below.
The code for these classes can use the per-atom properties defined by
fix property/atom.  The Atom class has a find_custom() method that is
useful in this context:</p>
<pre class="literal-block">int index = atom-&gt;find_custom(char *name, int &amp;flag);</pre>
<p>The “name” of a custom attribute, as specified in the <a class="reference internal" href="fix_property.html"><span class="doc">fix property/atom</span></a> command, is checked to verify
that it exists and its index is returned.  The method also sets flag =
0/1 depending on whether it is an integer or floating-point attribute.
The vector of values associated with the attribute can then be
accessed using the returned index as</p>
<pre class="literal-block">int *ivector = atom-&gt;ivector[index];
double *dvector = atom-&gt;dvector[index];</pre>
<p>Ivector or dvector are vectors of length Nlocal = # of owned atoms,
which store the attributes of individual atoms.</p>
<hr class="docutils" />
</section>
<section id="bond-angle-dihedral-improper-potentials">
<span id="mod-2"></span><h2><span class="section-number">12.2. </span>Bond, angle, dihedral, improper potentials<a class="headerlink" href="#bond-angle-dihedral-improper-potentials" title="Permalink to this heading">¶</a></h2>
<p>Classes that compute molecular interactions are derived from the Bond,
Angle, Dihedral, and Improper classes.  New styles can be created to
add new potentials to LAMMPS.</p>
<p>Bond_harmonic.cpp is the simplest example of a bond style.  Ditto for
the harmonic forms of the angle, dihedral, and improper style
commands.</p>
<p>Here is a brief description of common methods you define in your
new derived class.  See bond.h, angle.h, dihedral.h, and improper.h
for details and specific additional methods.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>init</p></td>
<td><p>check if all coefficients are set, calls <em>init_style</em> (optional)</p></td>
</tr>
<tr class="row-even"><td><p>init_style</p></td>
<td><p>check if style specific conditions are met (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>compute</p></td>
<td><p>compute the molecular interactions (required)</p></td>
</tr>
<tr class="row-even"><td><p>settings</p></td>
<td><p>apply global settings for all types (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>coeff</p></td>
<td><p>set coefficients for one type (required)</p></td>
</tr>
<tr class="row-even"><td><p>equilibrium_distance</p></td>
<td><p>length of bond, used by SHAKE (required, bond only)</p></td>
</tr>
<tr class="row-odd"><td><p>equilibrium_angle</p></td>
<td><p>opening of angle, used by SHAKE (required, angle only)</p></td>
</tr>
<tr class="row-even"><td><p>write &amp; read_restart</p></td>
<td><p>writes/reads coeffs to restart files (required)</p></td>
</tr>
<tr class="row-odd"><td><p>single</p></td>
<td><p>force and energy of a single bond or angle (required, bond or angle only)</p></td>
</tr>
<tr class="row-even"><td><p>memory_usage</p></td>
<td><p>tally memory allocated by the style (optional)</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="compute-styles">
<span id="mod-3"></span><h2><span class="section-number">12.3. </span>Compute styles<a class="headerlink" href="#compute-styles" title="Permalink to this heading">¶</a></h2>
<p>Classes that compute scalar and vector quantities like temperature
and the pressure tensor, as well as classes that compute per-atom
quantities like kinetic energy and the centro-symmetry parameter
are derived from the Compute class.  New styles can be created
to add new calculations to LAMMPS.</p>
<p>Compute_temp.cpp is a simple example of computing a scalar
temperature.  Compute_ke_atom.cpp is a simple example of computing
per-atom kinetic energy.</p>
<p>Here is a brief description of methods you define in your new derived
class.  See compute.h for details.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>init</p></td>
<td><p>perform one time setup (required)</p></td>
</tr>
<tr class="row-even"><td><p>init_list</p></td>
<td><p>neighbor list setup, if needed (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>compute_scalar</p></td>
<td><p>compute a scalar quantity (optional)</p></td>
</tr>
<tr class="row-even"><td><p>compute_vector</p></td>
<td><p>compute a vector of quantities (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>compute_peratom</p></td>
<td><p>compute one or more quantities per atom (optional)</p></td>
</tr>
<tr class="row-even"><td><p>compute_local</p></td>
<td><p>compute one or more quantities per processor (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>pack_comm</p></td>
<td><p>pack a buffer with items to communicate (optional)</p></td>
</tr>
<tr class="row-even"><td><p>unpack_comm</p></td>
<td><p>unpack the buffer (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>pack_reverse</p></td>
<td><p>pack a buffer with items to reverse communicate (optional)</p></td>
</tr>
<tr class="row-even"><td><p>unpack_reverse</p></td>
<td><p>unpack the buffer (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>remove_bias</p></td>
<td><p>remove velocity bias from one atom (optional)</p></td>
</tr>
<tr class="row-even"><td><p>remove_bias_all</p></td>
<td><p>remove velocity bias from all atoms in group (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>restore_bias</p></td>
<td><p>restore velocity bias for one atom after remove_bias (optional)</p></td>
</tr>
<tr class="row-even"><td><p>restore_bias_all</p></td>
<td><p>same as before, but for all atoms in group (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>memory_usage</p></td>
<td><p>tally memory usage (optional)</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="dump-styles">
<span id="mod-4"></span><h2><span class="section-number">12.4. </span>Dump styles<a class="headerlink" href="#dump-styles" title="Permalink to this heading">¶</a></h2>
</section>
<section id="dump-custom-output-options">
<span id="mod-5"></span><h2><span class="section-number">12.5. </span>Dump custom output options<a class="headerlink" href="#dump-custom-output-options" title="Permalink to this heading">¶</a></h2>
<p>Classes that dump per-atom info to files are derived from the Dump
class.  To dump new quantities or in a new format, a new derived dump
class can be added, but it is typically simpler to modify the
DumpCustom class contained in the dump_custom.cpp file.</p>
<p>Dump_atom.cpp is a simple example of a derived dump class.</p>
<p>Here is a brief description of methods you define in your new derived
class.  See dump.h for details.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>write_header</p></td>
<td><p>write the header section of a snapshot of atoms</p></td>
</tr>
<tr class="row-even"><td><p>count</p></td>
<td><p>count the number of lines a processor will output</p></td>
</tr>
<tr class="row-odd"><td><p>pack</p></td>
<td><p>pack a proc’s output data into a buffer</p></td>
</tr>
<tr class="row-even"><td><p>write_data</p></td>
<td><p>write a proc’s data to a file</p></td>
</tr>
</tbody>
</table>
<p>See the <a class="reference internal" href="dump.html"><span class="doc">dump</span></a> command and its <em>custom</em> style for a list of
keywords for atom information that can already be dumped by
DumpCustom.  It includes options to dump per-atom info from Compute
classes, so adding a new derived Compute class is one way to calculate
new quantities to dump.</p>
<p>Alternatively, you can add new keywords to the dump custom command.
Search for the word “customize” in dump_custom.cpp to see the
half-dozen or so locations where code will need to be added.</p>
<hr class="docutils" />
</section>
<section id="fix-styles">
<span id="mod-6"></span><h2><span class="section-number">12.6. </span>Fix styles<a class="headerlink" href="#fix-styles" title="Permalink to this heading">¶</a></h2>
<p>In LAMMPS, a “fix” is any operation that is computed during
timestepping that alters some property of the system.  Essentially
everything that happens during a simulation besides force computation,
neighbor list construction, and output, is a “fix”.  This includes
time integration (update of coordinates and velocities), force
constraints or boundary conditions (SHAKE or walls), and diagnostics
(compute a diffusion coefficient).  New styles can be created to add
new options to LAMMPS.</p>
<p>Fix_setforce.cpp is a simple example of setting forces on atoms to
prescribed values.  There are dozens of fix options already in LAMMPS;
choose one as a template that is similar to what you want to
implement.</p>
<p>Here is a brief description of methods you can define in your new
derived class.  See fix.h for details.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 77%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>setmask</p></td>
<td><p>determines when the fix is called during the timestep (required)</p></td>
</tr>
<tr class="row-even"><td><p>init</p></td>
<td><p>initialization before a run (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>setup_pre_exchange</p></td>
<td><p>called before atom exchange in setup (optional)</p></td>
</tr>
<tr class="row-even"><td><p>setup_pre_force</p></td>
<td><p>called before force computation in setup (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>setup</p></td>
<td><p>called immediately before the 1st timestep and after forces are computed (optional)</p></td>
</tr>
<tr class="row-even"><td><p>min_setup_pre_force</p></td>
<td><p>like setup_pre_force, but for minimizations instead of MD runs (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>min_setup</p></td>
<td><p>like setup, but for minimizations instead of MD runs (optional)</p></td>
</tr>
<tr class="row-even"><td><p>initial_integrate</p></td>
<td><p>called at very beginning of each timestep (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>pre_exchange</p></td>
<td><p>called before atom exchange on re-neighboring steps (optional)</p></td>
</tr>
<tr class="row-even"><td><p>pre_neighbor</p></td>
<td><p>called before neighbor list build (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>pre_force</p></td>
<td><p>called before pair &amp; molecular forces are computed (optional)</p></td>
</tr>
<tr class="row-even"><td><p>post_force</p></td>
<td><p>called after pair &amp; molecular forces are computed and communicated (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>final_integrate</p></td>
<td><p>called at end of each timestep (optional)</p></td>
</tr>
<tr class="row-even"><td><p>end_of_step</p></td>
<td><p>called at very end of timestep (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>write_restart</p></td>
<td><p>dumps fix info to restart file (optional)</p></td>
</tr>
<tr class="row-even"><td><p>restart</p></td>
<td><p>uses info from restart file to re-initialize the fix (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>grow_arrays</p></td>
<td><p>allocate memory for atom-based arrays used by fix (optional)</p></td>
</tr>
<tr class="row-even"><td><p>copy_arrays</p></td>
<td><p>copy atom info when an atom migrates to a new processor (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>pack_exchange</p></td>
<td><p>store atom’s data in a buffer (optional)</p></td>
</tr>
<tr class="row-even"><td><p>unpack_exchange</p></td>
<td><p>retrieve atom’s data from a buffer (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>pack_restart</p></td>
<td><p>store atom’s data for writing to restart file (optional)</p></td>
</tr>
<tr class="row-even"><td><p>unpack_restart</p></td>
<td><p>retrieve atom’s data from a restart file buffer (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>size_restart</p></td>
<td><p>size of atom’s data (optional)</p></td>
</tr>
<tr class="row-even"><td><p>maxsize_restart</p></td>
<td><p>max size of atom’s data (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>setup_pre_force_respa</p></td>
<td><p>same as setup_pre_force, but for rRESPA (optional)</p></td>
</tr>
<tr class="row-even"><td><p>initial_integrate_respa</p></td>
<td><p>same as initial_integrate, but for rRESPA (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>post_integrate_respa</p></td>
<td><p>called after the first half integration step is done in rRESPA (optional)</p></td>
</tr>
<tr class="row-even"><td><p>pre_force_respa</p></td>
<td><p>same as pre_force, but for rRESPA (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>post_force_respa</p></td>
<td><p>same as post_force, but for rRESPA (optional)</p></td>
</tr>
<tr class="row-even"><td><p>final_integrate_respa</p></td>
<td><p>same as final_integrate, but for rRESPA (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>min_pre_force</p></td>
<td><p>called after pair &amp; molecular forces are computed in minimizer (optional)</p></td>
</tr>
<tr class="row-even"><td><p>min_post_force</p></td>
<td><p>called after pair &amp; molecular forces are computed and communicated in minimizer (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>min_store</p></td>
<td><p>store extra data for linesearch based minimization on a LIFO stack (optional)</p></td>
</tr>
<tr class="row-even"><td><p>min_pushstore</p></td>
<td><p>push the minimization LIFO stack one element down (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>min_popstore</p></td>
<td><p>pop the minimization LIFO stack one element up (optional)</p></td>
</tr>
<tr class="row-even"><td><p>min_clearstore</p></td>
<td><p>clear minimization LIFO stack (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>min_step</p></td>
<td><p>reset or move forward on line search minimization (optional)</p></td>
</tr>
<tr class="row-even"><td><p>min_dof</p></td>
<td><p>report number of degrees of freedom <em>added</em> by this fix in minimization (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>max_alpha</p></td>
<td><p>report maximum allowed step size during linesearch minimization (optional)</p></td>
</tr>
<tr class="row-even"><td><p>pack_comm</p></td>
<td><p>pack a buffer to communicate a per-atom quantity (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>unpack_comm</p></td>
<td><p>unpack a buffer to communicate a per-atom quantity (optional)</p></td>
</tr>
<tr class="row-even"><td><p>pack_reverse_comm</p></td>
<td><p>pack a buffer to reverse communicate a per-atom quantity (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>unpack_reverse_comm</p></td>
<td><p>unpack a buffer to reverse communicate a per-atom quantity (optional)</p></td>
</tr>
<tr class="row-even"><td><p>dof</p></td>
<td><p>report number of degrees of freedom <em>removed</em> by this fix during MD (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>compute_scalar</p></td>
<td><p>return a global scalar property that the fix computes (optional)</p></td>
</tr>
<tr class="row-even"><td><p>compute_vector</p></td>
<td><p>return a component of a vector property that the fix computes (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>compute_array</p></td>
<td><p>return a component of an array property that the fix computes (optional)</p></td>
</tr>
<tr class="row-even"><td><p>deform</p></td>
<td><p>called when the box size is changed (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>reset_target</p></td>
<td><p>called when a change of the target temperature is requested during a run (optional)</p></td>
</tr>
<tr class="row-even"><td><p>reset_dt</p></td>
<td><p>is called when a change of the time step is requested during a run (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>modify_param</p></td>
<td><p>called when a fix_modify request is executed (optional)</p></td>
</tr>
<tr class="row-even"><td><p>memory_usage</p></td>
<td><p>report memory used by fix (optional)</p></td>
</tr>
<tr class="row-odd"><td><p>thermo</p></td>
<td><p>compute quantities for thermodynamic output (optional)</p></td>
</tr>
</tbody>
</table>
<p>Typically, only a small fraction of these methods are defined for a
particular fix.  Setmask is mandatory, as it determines when the fix
will be invoked during the timestep.  Fixes that perform time
integration (<em>nve</em>, <em>nvt</em>, <em>npt</em>) implement initial_integrate() and
final_integrate() to perform velocity Verlet updates.  Fixes that
constrain forces implement post_force().</p>
<p>Fixes that perform diagnostics typically implement end_of_step().  For
an end_of_step fix, one of your fix arguments must be the variable
“nevery” which is used to determine when to call the fix and you must
set this variable in the constructor of your fix.  By convention, this
is the first argument the fix defines (after the ID, group-ID, style).</p>
<p>If the fix needs to store information for each atom that persists from
timestep to timestep, it can manage that memory and migrate the info
with the atoms as they move from processors to processor by
implementing the grow_arrays, copy_arrays, pack_exchange, and
unpack_exchange methods.  Similarly, the pack_restart and
unpack_restart methods can be implemented to store information about
the fix in restart files.  If you wish an integrator or force
constraint fix to work with rRESPA (see the <a class="reference internal" href="run_style.html"><span class="doc">run_style</span></a>
command), the initial_integrate, post_force_integrate, and
final_integrate_respa methods can be implemented.  The thermo method
enables a fix to contribute values to thermodynamic output, as printed
quantities and/or to be summed to the potential energy of the system.</p>
<hr class="docutils" />
</section>
<section id="mod-7">
<span id="id1"></span><h2><span class="section-number">12.7. </span>Input script commands<a class="headerlink" href="#mod-7" title="Permalink to this heading">¶</a></h2>
<p>New commands can be added to LAMMPS input scripts by adding new
classes that have a “command” method.  For example, the create_atoms,
read_data, velocity, and run commands are all implemented in this
fashion.  When such a command is encountered in the LAMMPS input
script, LAMMPS simply creates a class with the corresponding name,
invokes the “command” method of the class, and passes it the arguments
from the input script.  The command method can perform whatever
operations it wishes on LAMMPS data structures.</p>
<p>The single method your new class must define is as follows:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 82%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>command</p></td>
<td><p>operations performed by the new command</p></td>
</tr>
</tbody>
</table>
<p>Of course, the new class can define other methods and variables as
needed.</p>
<hr class="docutils" />
</section>
<section id="kspace-computations">
<span id="mod-8"></span><h2><span class="section-number">12.8. </span>Kspace computations<a class="headerlink" href="#kspace-computations" title="Permalink to this heading">¶</a></h2>
<p>Classes that compute long-range Coulombic interactions via K-space
representations (Ewald, PPPM) are derived from the KSpace class.  New
styles can be created to add new K-space options to LAMMPS.</p>
<p>Ewald.cpp is an example of computing K-space interactions.</p>
<p>Here is a brief description of methods you define in your new derived
class.  See kspace.h for details.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>init</p></td>
<td><p>initialize the calculation before a run</p></td>
</tr>
<tr class="row-even"><td><p>setup</p></td>
<td><p>computation before the 1st timestep of a run</p></td>
</tr>
<tr class="row-odd"><td><p>compute</p></td>
<td><p>every-timestep computation</p></td>
</tr>
<tr class="row-even"><td><p>memory_usage</p></td>
<td><p>tally of memory usage</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="minimization-styles">
<span id="mod-9"></span><h2><span class="section-number">12.9. </span>Minimization styles<a class="headerlink" href="#minimization-styles" title="Permalink to this heading">¶</a></h2>
<p>Classes that perform energy minimization derived from the Min class.
New styles can be created to add new minimization algorithms to
LAMMPS.</p>
<p>Min_cg.cpp is an example of conjugate gradient minimization.</p>
<p>Here is a brief description of methods you define in your new derived
class.  See min.h for details.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 74%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>init</p></td>
<td><p>initialize the minimization before a run</p></td>
</tr>
<tr class="row-even"><td><p>run</p></td>
<td><p>perform the minimization</p></td>
</tr>
<tr class="row-odd"><td><p>memory_usage</p></td>
<td><p>tally of memory usage</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="pairwise-potentials">
<span id="mod-10"></span><h2><span class="section-number">12.10. </span>Pairwise potentials<a class="headerlink" href="#pairwise-potentials" title="Permalink to this heading">¶</a></h2>
<p>Classes that compute pairwise interactions are derived from the Pair
class.  In LAMMPS, pairwise calculation include manybody potentials
such as EAM or Tersoff where particles interact without a static bond
topology.  New styles can be created to add new pair potentials to
LAMMPS.</p>
<p>Pair_lj_cut.cpp is a simple example of a Pair class, though it
includes some optional methods to enable its use with rRESPA.</p>
<p>Here is a brief description of the class methods in pair.h:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 67%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>compute</p></td>
<td><p>workhorse routine that computes pairwise interactions</p></td>
</tr>
<tr class="row-even"><td><p>settings</p></td>
<td><p>reads the input script line with arguments you define</p></td>
</tr>
<tr class="row-odd"><td><p>coeff</p></td>
<td><p>set coefficients for one i,j type pair</p></td>
</tr>
<tr class="row-even"><td><p>init_one</p></td>
<td><p>perform initialization for one i,j type pair</p></td>
</tr>
<tr class="row-odd"><td><p>init_style</p></td>
<td><p>initialization specific to this pair style</p></td>
</tr>
<tr class="row-even"><td><p>write &amp; read_restart</p></td>
<td><p>write/read i,j pair coeffs to restart files</p></td>
</tr>
<tr class="row-odd"><td><p>write &amp; read_restart_settings</p></td>
<td><p>write/read global settings to restart files</p></td>
</tr>
<tr class="row-even"><td><p>single</p></td>
<td><p>force and energy of a single pairwise interaction between 2 atoms</p></td>
</tr>
<tr class="row-odd"><td><p>compute_inner/middle/outer</p></td>
<td><p>versions of compute used by rRESPA</p></td>
</tr>
</tbody>
</table>
<p>The inner/middle/outer routines are optional.</p>
<hr class="docutils" />
</section>
<section id="region-styles">
<span id="mod-11"></span><h2><span class="section-number">12.11. </span>Region styles<a class="headerlink" href="#region-styles" title="Permalink to this heading">¶</a></h2>
<p>Classes that define geometric regions are derived from the Region
class.  Regions are used elsewhere in LAMMPS to group atoms, delete
atoms to create a void, insert atoms in a specified region, etc.  New
styles can be created to add new region shapes to LAMMPS.</p>
<p>Region_sphere.cpp is an example of a spherical region.</p>
<p>Here is a brief description of methods you define in your new derived
class.  See region.h for details.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 78%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>inside</p></td>
<td><p>determine whether a point is in the region</p></td>
</tr>
<tr class="row-even"><td><p>surface_interior</p></td>
<td><p>determine if a point is within a cutoff distance inside of surf</p></td>
</tr>
<tr class="row-odd"><td><p>surface_exterior</p></td>
<td><p>determine if a point is within a cutoff distance outside of surf</p></td>
</tr>
<tr class="row-even"><td><p>shape_update</p></td>
<td><p>change region shape if set by time-dependent variable</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="body-styles">
<span id="mod-12"></span><h2><span class="section-number">12.12. </span>Body styles<a class="headerlink" href="#body-styles" title="Permalink to this heading">¶</a></h2>
<p>Classes that define body particles are derived from the Body class.
Body particles can represent complex entities, such as surface meshes
of discrete points, collections of sub-particles, deformable objects,
etc.</p>
<p>See <a class="reference internal" href="Section_howto.html#howto-14"><span class="std std-ref">Section_howto 14</span></a> of the manual for
an overview of using body particles and the <a class="reference internal" href="body.html"><span class="doc">body</span></a> doc page
for details on the various body styles LAMMPS supports.  New styles
can be created to add new kinds of body particles to LAMMPS.</p>
<p>Body_nparticle.cpp is an example of a body particle that is treated as
a rigid body containing N sub-particles.</p>
<p>Here is a brief description of methods you define in your new derived
class.  See body.h for details.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>data_body</p></td>
<td><p>process a line from the Bodies section of a data file</p></td>
</tr>
<tr class="row-even"><td><p>noutrow</p></td>
<td><p>number of sub-particles output is generated for</p></td>
</tr>
<tr class="row-odd"><td><p>noutcol</p></td>
<td><p>number of values per-sub-particle output is generated for</p></td>
</tr>
<tr class="row-even"><td><p>output</p></td>
<td><p>output values for the Mth sub-particle</p></td>
</tr>
<tr class="row-odd"><td><p>pack_comm_body</p></td>
<td><p>body attributes to communicate every timestep</p></td>
</tr>
<tr class="row-even"><td><p>unpack_comm_body</p></td>
<td><p>unpacking of those attributes</p></td>
</tr>
<tr class="row-odd"><td><p>pack_border_body</p></td>
<td><p>body attributes to communicate when reneighboring is done</p></td>
</tr>
<tr class="row-even"><td><p>unpack_border_body</p></td>
<td><p>unpacking of those attributes</p></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="thermodynamic-output-options">
<span id="mod-13"></span><h2><span class="section-number">12.13. </span>Thermodynamic output options<a class="headerlink" href="#thermodynamic-output-options" title="Permalink to this heading">¶</a></h2>
<p>There is one class that computes and prints thermodynamic information
to the screen and log file; see the file thermo.cpp.</p>
<p>There are two styles defined in thermo.cpp: “one” and “multi”.  There
is also a flexible “custom” style which allows the user to explicitly
list keywords for quantities to print when thermodynamic info is
output.  See the <a class="reference internal" href="thermo_style.html"><span class="doc">thermo_style</span></a> command for a list
of defined quantities.</p>
<p>The thermo styles (one, multi, etc) are simply lists of keywords.
Adding a new style thus only requires defining a new list of keywords.
Search for the word “customize” with references to “thermo style” in
thermo.cpp to see the two locations where code will need to be added.</p>
<p>New keywords can also be added to thermo.cpp to compute new quantities
for output.  Search for the word “customize” with references to
“keyword” in thermo.cpp to see the several locations where code will
need to be added.</p>
<p>Note that the <a class="reference internal" href="thermo.html"><span class="doc">thermo_style custom</span></a> command already allows
for thermo output of quantities calculated by <a class="reference internal" href="fix.html"><span class="doc">fixes</span></a>,
<a class="reference internal" href="compute.html"><span class="doc">computes</span></a>, and <a class="reference internal" href="variable.html"><span class="doc">variables</span></a>.  Thus, it may
be simpler to compute what you wish via one of those constructs, than
by adding a new keyword to the thermo command.</p>
<hr class="docutils" />
</section>
<section id="variable-options">
<span id="mod-14"></span><h2><span class="section-number">12.14. </span>Variable options<a class="headerlink" href="#variable-options" title="Permalink to this heading">¶</a></h2>
<p>There is one class that computes and stores <a class="reference internal" href="variable.html"><span class="doc">variable</span></a>
information in LAMMPS; see the file variable.cpp.  The value
associated with a variable can be periodically printed to the screen
via the <a class="reference internal" href="print.html"><span class="doc">print</span></a>, <a class="reference internal" href="fix_print.html"><span class="doc">fix print</span></a>, or
<a class="reference internal" href="thermo_style.html"><span class="doc">thermo_style custom</span></a> commands.  Variables of style
“equal” can compute complex equations that involve the following types
of arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">thermo</span> <span class="n">keywords</span> <span class="o">=</span> <span class="n">ke</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="o">...</span>
<span class="n">other</span> <span class="n">variables</span> <span class="o">=</span> <span class="n">v_a</span><span class="p">,</span> <span class="n">v_myvar</span><span class="p">,</span> <span class="o">...</span>
<span class="n">math</span> <span class="n">functions</span> <span class="o">=</span> <span class="n">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">mult</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span> <span class="o">...</span>
<span class="n">group</span> <span class="n">functions</span> <span class="o">=</span> <span class="n">mass</span><span class="p">(</span><span class="n">group</span><span class="p">),</span> <span class="n">xcm</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="o">...</span>
<span class="n">atom</span> <span class="n">values</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">123</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">vx</span><span class="p">[</span><span class="mi">34</span><span class="p">],</span> <span class="o">...</span>
<span class="n">compute</span> <span class="n">values</span> <span class="o">=</span> <span class="n">c_mytemp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c_thermo_press</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="o">...</span>
</pre></div>
</div>
<p>Adding keywords for the <a class="reference internal" href="thermo_style.html"><span class="doc">thermo_style custom</span></a> command
(which can then be accessed by variables) was discussed
<a class="reference internal" href="Section_howto.html#thermo"><span class="std std-ref">here</span></a> on this page.</p>
<p>Adding a new math function of one or two arguments can be done by
editing one section of the Variable::evaluate() method.  Search for
the word “customize” to find the appropriate location.</p>
<p>Adding a new group function can be done by editing one section of the
Variable::evaluate() method.  Search for the word “customize” to find
the appropriate location.  You may need to add a new method to the
Group class as well (see the group.cpp file).</p>
<p>Accessing a new atom-based vector can be done by editing one section
of the Variable::evaluate() method.  Search for the word “customize”
to find the appropriate location.</p>
<p>Adding new <a class="reference internal" href="compute.html"><span class="doc">compute styles</span></a> (whose calculated values can
then be accessed by variables) was discussed
<a class="reference internal" href="Section_howto.html#compute"><span class="std std-ref">here</span></a> on this page.</p>
</section>
<section id="submitting-new-features-for-inclusion-in-lammps">
<span id="mod-15"></span><h2><span class="section-number">12.15. </span>Submitting new features for inclusion in LAMMPS<a class="headerlink" href="#submitting-new-features-for-inclusion-in-lammps" title="Permalink to this heading">¶</a></h2>
<p>We encourage users to submit new features that they add to LAMMPS to
<a class="reference external" href="http://lammps.sandia.gov/authors.html">the developers</a>, especially if
you think the features will be of interest to other users.  If they
are broadly useful we may add them as core files to LAMMPS or as part
of a <a class="reference internal" href="Section_start.html#start-3"><span class="std std-ref">standard package</span></a>.  Else we will add
them as a user-contributed package or file.  Examples of user packages
are in src sub-directories that start with USER.  The USER-MISC
package is simply a collection of (mostly) unrelated single files,
which is the simplest way to have your contribution quickly added to
the LAMMPS distribution.  You can see a list of the both standard and
user packages by typing “make package” in the LAMMPS src directory.</p>
<p>With user packages and files, all we are really providing (aside from
the fame and fortune that accompanies having your name in the source
code and on the <a class="reference external" href="http://lammps.sandia.gov/authors.html">Authors page</a>
of the <a class="reference external" href="http://lammps.sandia.gov">LAMMPS WWW site</a>), is a means for you to distribute your
work to the LAMMPS user community and a mechanism for others to easily
try out your new feature.  This may help you find bugs or make contact
with new collaborators.  Note that you’re also implicitly agreeing to
support your code which means answer questions, fix bugs, and maintain
it if LAMMPS changes.</p>
<p>The previous sections of this doc page describe how to add new
features of various kinds to LAMMPS.  Packages are simply collections
of one or more new class files which are invoked as a new “style”
within a LAMMPS input script.  If designed correctly, these additions
typically do not require changes to the main core of LAMMPS; they are
simply add-on files.  If you think your new feature requires
non-trivial changes in core LAMMPS files, you’ll need to <a class="reference external" href="http://lammps.sandia.gov/authors.html">communicate with the developers</a>, since we
may or may not want to make those changes.  An example of a trivial
change is making a parent-class method “virtual” when you derive a new
child class from it.</p>
<p>Here is what you need to do to submit a user package or single file
for our consideration.  Following these steps will save time for both
you and us.  See existing package files for examples.</p>
<ul class="simple">
<li><p>All source files you provide must compile with the most current
version of LAMMPS.</p></li>
<li><p>If you want your file(s) to be added to main LAMMPS or one of its
standard packages, then it needs to be written in a style compatible
with other LAMMPS source files.  This is so the developers can
understand it and hopefully maintain it.  This basically means that
the code accesses data structures, performs its operations, and is
formatted similar to other LAMMPS source files, including the use of
the error class for error and warning messages.</p></li>
<li><p>If your contribution is a single file (actually a *.cpp and *.h file)
it can most rapidly be added to the USER-MISC directory.  Send us the
one-line entry to add to the USER-MISC/README file in that dir, along
with the 2 source files.  You can do this multiple times if you wish
to contribute several individual features.</p></li>
<li><p>If your contribution is several related features, it is probably best
to make it a user package directory with a name like USER-FOO.  In
addition to your new files, the directory should contain a README, and
Install.csh file.  The README text file should contain your name and
contact information and a brief description of what your new package
does.  The Install.csh file enables LAMMPS to include and exclude your
package.  See other README and Install.sh files in other USER
directories as examples.  Send us a tarball of this USER-FOO
directory.</p></li>
<li><p>Your new source files need to have the LAMMPS copyright, GPL notice,
and your name at the top, like other LAMMPS source files.  They need
to create a class that is inside the LAMMPS namespace.  If the file is
for one of the USER packages, including USER-MISC, then we are not as
picky about the coding style (see above).  I.e. they do not need to be
in the same stylistic format and syntax as other LAMMPS files, though
that would be nice.</p></li>
<li><p>Finally, you <strong>must</strong> also create a <strong>documentation</strong> file for each new command
or style you are adding to LAMMPS.  This will be one file for a
single-file feature.  For a package, it might be several files.  These
are simple text files with a specific markup language, that can be
auto-converted to HTML.  The documentation source files must be in
the same format as other *.txt files in the lammps/doc directory for
similar commands and styles.  The “Restrictions” section of the doc
page should indicate that your command is only available if LAMMPS is
built with the appropriate USER-MISC or USER-FOO package.  See other
user package doc files for an example of how to do this.  The txt2html
tool we use to do the conversion can be downloaded from <a class="reference external" href="http://www.sandia.gov/~sjplimp/download.html">this site</a>, so you can perform
the HTML conversion yourself to proofread your doc page.</p></li>
</ul>
<p>Note that the more clear and self-explanatory you make your doc and
README files, the more likely it is that users will try out your new
feature.</p>
<p id="foo"><strong>(Foo)</strong> Foo, Morefoo, and Maxfoo, J of Classic Potentials, 75, 345 (1997).</p>
</section>
</section>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Section_python.html" class="btn btn-neutral float-right" title="13. Python interface to LAMMPS" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Section_tools.html" class="btn btn-neutral" title="11. Additional tools" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018 JKU Linz, DCS Computing GmbH and Sandia Corporation.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'24.01',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/documentation_options.js"></script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js"></script>
      <script type="text/javascript" src="_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>